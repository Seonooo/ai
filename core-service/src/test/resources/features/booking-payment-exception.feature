@payment @exception
Feature: 결제 예외 처리
  잘못된 결제 요청에 대해 적절한 예외가 발생해야 한다.

  Background:
    Given 예약 가능한 콘서트 스케줄이 존재한다
    And 유효한 대기열 토큰을 보유하고 있다

  # TODO: 결제 로직 개발 시 추가
  # Scenario: 결제 금액이 일치하지 않으면 결제할 수 없다
  #   Given 내가 생성한 예약이 존재한다
  #   When 해당 예약에 대해 잘못된 금액으로 결제를 요청한다
  #   Then 요청된 결제 금액 불일치로 거부된다
  #   And 금액이 일치하지 않는다는 메시지가 반환된다

  Scenario: 예약자가 아닌 사용자는 결제할 수 없다
    Given 다른 사용자가 생성한 예약이 존재한다
    When 해당 예약에 대해 내가 결제를 요청한다
    Then 요청된 결제가 사용자 불일치로 거부된다
    And 접근 권한이 없다는 메시지가 반환된다

  Scenario: 이미 결제된 예약은 중복 결제할 수 없다
    Given 내가 생성한 예약이 이미 확정(Payment Completed) 상태이다
    When 해당 예약에 대해 결제를 요청한다
    Then 중복 결제 요청이 거부된다
    And 이미 확정된 예약이라는 메시지가 반환된다

  Scenario: 만료된 예약에 대해 결제할 수 없다
      # P0에서 이미 커버되었으나, 명시적 Payment 관점에서 재확인 (선택적)
      # P0와 겹치므로 생략하거나, 다른 각도에서 테스트 가능
      # 여기서는 생략
